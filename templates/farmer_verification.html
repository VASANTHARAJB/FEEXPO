<!DOCTYPE html>
<html>
<head>
    <title>Farmer Verification</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script>
        function toggleLeaseUpload() {
            var landType = document.getElementById("land_type").value;
            var leaseDiv = document.getElementById("lease_upload_section");

            if (landType === "lease") {
                leaseDiv.style.display = "block";
            } else {
                leaseDiv.style.display = "none";
            }
        }

        // --- NEW HACKATHON GPS LOGIC ---
        function getLiveLocation() {
            var status = document.getElementById("location-status");
            var latInput = document.getElementsByName("latitude")[0];
            var lonInput = document.getElementsByName("longitude")[0];

            status.innerHTML = "Locating via GPS... Please wait.";
            status.style.color = "orange";

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    // Auto-fill the inputs
                    latInput.value = position.coords.latitude.toFixed(6);
                    lonInput.value = position.coords.longitude.toFixed(6);
                    
                    status.innerHTML = "‚úÖ Location Locked! You are ready to sell to local customers.";
                    status.style.color = "green";
                }, function(error) {
                    status.innerHTML = "‚ùå Please allow location access in your browser.";
                    status.style.color = "red";
                });
            } else {
                status.innerHTML = "Geolocation is not supported by your browser.";
                status.style.color = "red";
            }
        }
    </script>
</head>
<body>

<div class="form-card">
    <h2 class="app-title">Farmer Verification</h2>

    <form method="POST" action="/submit_farmer_verification" enctype="multipart/form-data">

        <h3>Identity Verification</h3>
        <label>Aadhaar Upload:</label>
        <input type="file" name="aadhaar_file" required><br><br>

        <h3>Land Details</h3>

        <label>Land Type:</label>
        <select name="land_type" id="land_type" class="form-input" onchange="toggleLeaseUpload()" required>
            <option value="">Select Land Type</option>
            <option value="owner">Land Owner</option>
            <option value="lease">Lease / Tenant Farmer</option>
        </select><br><br>

        <label>Survey Number:</label>
        <input type="text" name="survey_no" required><br>

        <label>Patta Number:</label>
        <input type="text" name="patta_no" required><br>

        <label>Patta Upload:</label>
        <input type="file" name="patta_file" required><br><br>

        <div id="lease_upload_section" style="display:none;">
            <label>Lease Agreement Upload:</label>
            <input type="file" name="lease_file"><br><br>
        </div>

        <h3>Activity Verification</h3>
        <label>Field Photo:</label>
        <input type="file" name="field_photo" required><br><br>

        <hr>
        <h3 style="color: #28a745;">üìç Live Location Sync</h3>
        <p style="font-size: 12px; color: #555;">Required to connect you with nearby customers for fast delivery.</p>
        
        <button type="button" onclick="getLiveLocation()" style="background: #28a745; color: white; padding: 10px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; margin-bottom: 10px;">
            Get My Live Location
        </button>
        <p id="location-status" style="font-weight: bold; margin-bottom: 15px;"></p>

        <label>Latitude:</label>
        <input type="text" name="latitude" readonly style="background: #e9ecef;" required><br>

        <label>Longitude:</label>
        <input type="text" name="longitude" readonly style="background: #e9ecef;" required><br><br>
        <hr>

        <button type="submit" style="margin-top: 15px;">Submit Verification</button>

    </form>
</div>

</body>
</html>